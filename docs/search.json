[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Survival Analysis with the deidentified Thyroid Cancer Dataset",
    "section": "",
    "text": "원격저장소 HTTP url: https://github.com/RPythonGroup/Survival_Exercise.git\n터메널에서 git clone 시 현재 디렉토리 하부에 지정하는 디렉토리명으로 clone 됨.\n\ngit clone https://github.com/RPythonGroup/Survival_Exercise.git R441-Survival_Exercise\n\n프로젝트만들기에서 기존 디렉토리에서 만들기에서 clone 된 디렉토리를 선택하면 됨.\n패키지관리를 renv로 하는 경우에는 renv::snapshot 등으로 renv.lock 파일의 패키지 목록과 일치화 시키면 바람직함."
  },
  {
    "objectID": "index.html#survfit함수와-객체",
    "href": "index.html#survfit함수와-객체",
    "title": "Survival Analysis with the deidentified Thyroid Cancer Dataset",
    "section": "survfit함수와 객체",
    "text": "survfit함수와 객체\n\nSurv 객체와 공변량을 formula 형태의 인자로 받아 Kaplan-Meier 또는 Cox 모델 기반 생존 확률을 저장한 객체를 반환\n\n\nKaplan-Meier 기반\n\nplot(survfit(km~1)) #Kaplan-Meier 기반\n\n\n\n\n\n\n\n\n\n\ncox model 기반\n\nkm_fit &lt;- survfit(km~rai_recur$sex) #cox model 기반\n\nplot(km_fit)\n\n\n\n\n\n\n\n\n\n\nsummary\n\nsummary(km_fit) \n\nCall: survfit(formula = km ~ rai_recur$sex)\n\n                rai_recur$sex=F \n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n    6    934       2    0.998 0.00151        0.995        1.000\n    8    932       2    0.996 0.00214        0.992        1.000\n    9    930       1    0.995 0.00239        0.990        0.999\n   10    929       1    0.994 0.00261        0.988        0.999\n   11    928       2    0.991 0.00302        0.986        0.997\n   12    926       1    0.990 0.00320        0.984        0.997\n   13    925       5    0.985 0.00398        0.977        0.993\n   14    920       3    0.982 0.00437        0.973        0.990\n   15    917       2    0.980 0.00462        0.971        0.989\n   17    915       1    0.979 0.00474        0.969        0.988\n   23    902       1    0.978 0.00485        0.968        0.987\n   25    898       2    0.975 0.00508        0.965        0.985\n   26    895       2    0.973 0.00530        0.963        0.984\n   28    888       2    0.971 0.00551        0.960        0.982\n   30    883       1    0.970 0.00561        0.959        0.981\n   31    880       1    0.969 0.00571        0.958        0.980\n   32    878       1    0.968 0.00581        0.956        0.979\n   33    876       1    0.967 0.00591        0.955        0.978\n   36    868       1    0.965 0.00601        0.954        0.977\n   42    850       1    0.964 0.00611        0.952        0.976\n   44    846       1    0.963 0.00620        0.951        0.975\n   45    844       1    0.962 0.00630        0.950        0.974\n   57    820       1    0.961 0.00640        0.948        0.973\n   59    816       1    0.960 0.00650        0.947        0.972\n   61    804       1    0.958 0.00660        0.946        0.971\n   70    787       1    0.957 0.00670        0.944        0.970\n   74    767       1    0.956 0.00681        0.943        0.969\n   78    762       1    0.955 0.00692        0.941        0.968\n   79    759       2    0.952 0.00712        0.938        0.966\n   85    753       1    0.951 0.00722        0.937        0.965\n   88    745       1    0.950 0.00733        0.935        0.964\n   90    740       1    0.948 0.00743        0.934        0.963\n   97    720       1    0.947 0.00753        0.932        0.962\n  100    710       1    0.946 0.00764        0.931        0.961\n  139    510       1    0.944 0.00785        0.929        0.959\n  149    436       1    0.942 0.00812        0.926        0.958\n  188    161       1    0.936 0.00996        0.917        0.956\n  251     47       1    0.916 0.02198        0.874        0.960\n  276     35       1    0.890 0.03348        0.827        0.958\n\n                rai_recur$sex=M \n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n    8    246       1    0.996 0.00406        0.988        1.000\n    9    245       1    0.992 0.00573        0.981        1.000\n   11    244       1    0.988 0.00700        0.974        1.000\n   19    242       1    0.984 0.00807        0.968        1.000\n   20    240       1    0.980 0.00902        0.962        0.997\n   24    234       2    0.971 0.01071        0.950        0.992\n   25    232       1    0.967 0.01145        0.945        0.990\n   26    231       1    0.963 0.01214        0.939        0.987\n   29    228       1    0.959 0.01280        0.934        0.984\n   32    225       1    0.954 0.01344        0.928        0.981\n   38    219       1    0.950 0.01407        0.923        0.978\n   41    218       1    0.946 0.01466        0.917        0.975\n   44    216       2    0.937 0.01578        0.907        0.968\n   46    212       2    0.928 0.01682        0.896        0.962\n   49    206       1    0.924 0.01733        0.890        0.958\n   51    204       1    0.919 0.01783        0.885        0.955\n   52    203       1    0.915 0.01831        0.879        0.951\n   53    201       1    0.910 0.01877        0.874        0.948\n   60    188       1    0.905 0.01929        0.868        0.944\n   63    183       1    0.900 0.01981        0.862        0.940\n   71    168       1    0.895 0.02040        0.856        0.936\n  103    145       2    0.882 0.02191        0.841        0.926\n  118    133       1    0.876 0.02272        0.832        0.922\n  138    116       1    0.868 0.02375        0.823        0.916\n  149     92       1    0.859 0.02530        0.811        0.910\n  176     46       1    0.840 0.03088        0.782        0.903\n\n\n\n\nsummary 기간지정\n\nsummary(km_fit, c(12*1:19)) ### 정해진 time에 맞는 생존테이블표를 만든다.\n\nCall: survfit(formula = km ~ rai_recur$sex)\n\n                rai_recur$sex=F \n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n   12    926       9    0.990 0.00320        0.984        0.997\n   24    898      12    0.978 0.00485        0.968        0.987\n   36    868      11    0.965 0.00601        0.954        0.977\n   48    833       3    0.962 0.00630        0.950        0.974\n   60    809       2    0.960 0.00650        0.947        0.972\n   72    777       2    0.957 0.00670        0.944        0.970\n   84    753       4    0.952 0.00712        0.938        0.966\n   96    723       3    0.948 0.00743        0.934        0.963\n  108    687       2    0.946 0.00764        0.931        0.961\n  120    641       0    0.946 0.00764        0.931        0.961\n  132    559       0    0.946 0.00764        0.931        0.961\n  144    474       1    0.944 0.00785        0.929        0.959\n  156    373       1    0.942 0.00812        0.926        0.958\n  168    297       0    0.942 0.00812        0.926        0.958\n  180    189       0    0.942 0.00812        0.926        0.958\n  192    143       1    0.936 0.00996        0.917        0.956\n  204    113       0    0.936 0.00996        0.917        0.956\n  216     88       0    0.936 0.00996        0.917        0.956\n  228     63       0    0.936 0.00996        0.917        0.956\n\n                rai_recur$sex=M \n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n   12    242       3    0.988  0.0070        0.974        1.000\n   24    234       4    0.971  0.0107        0.950        0.992\n   36    220       4    0.954  0.0134        0.928        0.981\n   48    208       6    0.928  0.0168        0.896        0.962\n   60    188       5    0.905  0.0193        0.868        0.944\n   72    164       2    0.895  0.0204        0.856        0.936\n   84    157       0    0.895  0.0204        0.856        0.936\n   96    146       0    0.895  0.0204        0.856        0.936\n  108    137       2    0.882  0.0219        0.841        0.926\n  120    131       1    0.876  0.0227        0.832        0.922\n  132    122       0    0.876  0.0227        0.832        0.922\n  144    105       1    0.868  0.0237        0.823        0.916\n  156     75       1    0.859  0.0253        0.811        0.910\n  168     54       0    0.859  0.0253        0.811        0.910\n  180     40       1    0.840  0.0309        0.782        0.903\n  192     33       0    0.840  0.0309        0.782        0.903\n  204     26       0    0.840  0.0309        0.782        0.903\n  216     19       0    0.840  0.0309        0.782        0.903\n  228     15       0    0.840  0.0309        0.782        0.903\n\n\n\n\nplot 그래프 - 범례추가\n\nplot(km_fit, col = rainbow(2), lty=1:2)\nlegend(\"topright\", legend = c(\"Female\",\"Male\"),\ncol= rainbow(2), lty=1:2)\n\n\n\n\n\n\n\n\n\n\nggsurvplot - risk.table 추가하기\n\nlibrary(survminer)\n\nWarning: package 'survminer' was built under R version 4.4.2\n\n\nLoading required package: ggplot2\n\n\nLoading required package: ggpubr\n\n\n\nAttaching package: 'survminer'\n\n\nThe following object is masked from 'package:survival':\n\n    myeloma\n\nggsurvplot(\n  km_fit, \n  data = rai_recur,\n  conf.int = T, \n  xscale = 12, ## xscale can be \"d_y\"\n  break.x.by = 5*12,\n  pval = T, \n  pval.size =4, \n  surv.median.line = \"hv\",\n  risk.table = TRUE, ## if TRUE, risk table is displayed under graph\n  legend.title=\"sex\", \n  legend.labs=c(\"Female\",\"Male\"),\n  palette = c(\"#E7B800\", \"#2E9FDF\"),\n)\n\nWarning in .add_surv_median(p, fit, type = surv.median.line, fun = fun, :\nMedian survival not reached.\n\n\n\n\n\n\n\n\n\n\n\ncox 단변량\n\\[\nh(t | X) = h_0(t) \\exp(\\beta_1 X_1 + \\beta_2 X_2 + \\dots + \\beta_p X_p)\n\\] #### sex에 대한 단변량\n\nunivariate_model &lt;- coxph(km ~ sex, data = rai_recur)\nsummary(univariate_model)\n\nCall:\ncoxph(formula = km ~ sex, data = rai_recur)\n\n  n= 1180, number of events= 83 \n\n       coef exp(coef) se(coef)     z Pr(&gt;|z|)    \nsexM 0.8430    2.3233   0.2287 3.686 0.000228 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n     exp(coef) exp(-coef) lower .95 upper .95\nsexM     2.323     0.4304     1.484     3.637\n\nConcordance= 0.58  (se = 0.027 )\nLikelihood ratio test= 12.29  on 1 df,   p=5e-04\nWald test            = 13.59  on 1 df,   p=2e-04\nScore (logrank) test = 14.41  on 1 df,   p=1e-04\n\n\n\n1️⃣ 검정 방법의 차이\n\nLikelihood Ratio Test: 모델 전체의 적합도를 평가하는 강력한 검정 방법.\nWald Test: 개별 회귀 계수가 0과 다른지 평가하지만, 샘플 크기가 작거나 계수가 매우 크면 부정확할 수 있음.\nScore Test: 작은 샘플에서도 안정적인 검정이지만, 일부 가정이 충족되지 않으면 결과가 다를 수 있음.\n\n\n\n2️⃣ 샘플 크기 및 데이터 특성\n\n샘플 크기가 작을 때 → Wald Test는 불안정할 수 있음.\n변수 간 다중공선성 → Wald Test와 LRT 결과가 다를 수 있음.\n검열 데이터 비율이 높을 때 → Score Test가 다른 두 검정과 다를 수 있음.\n\n\n\n📌 (1) Likelihood Ratio Test만 유의미하고 나머지는 유의미하지 않다면?\n\n모델이 전체적으로는 의미가 있지만, 개별 변수의 효과가 강하지 않을 수 있음.\n\nWald Test와 Score Test도 확인하면서 개별 변수의 기여도를 분석해야 함.\n\n\n\n📌 (2) Wald Test만 유의미하다면?\n\n특정 변수의 효과는 강하지만, 모델 전체가 데이터를 충분히 설명하지 못할 수 있음.\n\n변수 선택을 다시 검토하고 다중공선성을 점검해야 함.\n\n\n\n📌 (3) Score Test만 유의미하다면?\n\n데이터가 잘 맞지만, 특정 변수의 효과가 불확실할 가능성이 있음.\n\n모델의 구조와 데이터의 분포를 다시 확인해야 함.\n\n\n\n\ncox 단변량 반복\n\nmycph(Surv(time, recur) ~ sex+surgeon+Risk+pT+gross_ETE+pN+ENE, data = rai_recur)\n\n\n mycph : perform coxph of individual expecting variables\n\n Call: Surv(time, recur) ~ sex + surgeon + Risk + pT + gross_ETE + pN +     ENE, data= rai_recur \n\n\n                     HR   lcl    ucl     p\nsexM               2.32  1.48   3.64 0.000\nsurgeonGS          8.87  0.92  85.71 0.059\nsurgeonKCCH        2.50  0.23  27.64 0.454\nsurgeonLBC         3.88  0.47  32.25 0.209\nsurgeonLGH         4.44  0.61  32.63 0.142\nsurgeonLMC         3.05  0.38  24.40 0.293\nsurgeonLYS        11.07  1.29  95.20 0.028\nsurgeonOKK        18.73  1.67 209.73 0.017\nsurgeonoutside    19.61  2.64 145.48 0.004\nsurgeonSYS         3.13  0.35  28.06 0.309\nRiskIntermediate   0.39  0.25   0.62 0.000\nRiskLow            0.08  0.03   0.19 0.000\npTT1b              2.65  1.37   5.12 0.004\npTT2               5.63  2.77  11.42 0.000\npTT3a              7.86  2.98  20.75 0.000\npTT3b              4.04  1.53  10.64 0.005\npTT4a             12.51  5.47  28.57 0.000\npTT4b            110.48 14.15 862.67 0.000\ngross_ETEY         3.01  1.74   5.19 0.000\npNN1a              2.89  1.40   5.96 0.004\npNN1b              5.88  2.80  12.36 0.000\npNNx               1.92  0.58   6.34 0.285\nENEY               2.96  1.76   4.97 0.000\n\n\n\n\nMultivariate Analysis\n\ncox_model1 &lt;- coxph(Surv(time, recur) ~ sex+surgeon+Risk+pT+gross_ETE+pN+ENE, data = rai_recur)\nsummary(cox_model1)\n\nCall:\ncoxph(formula = Surv(time, recur) ~ sex + surgeon + Risk + pT + \n    gross_ETE + pN + ENE, data = rai_recur)\n\n  n= 1180, number of events= 83 \n\n                     coef exp(coef) se(coef)      z Pr(&gt;|z|)   \nsexM              0.45143   1.57055  0.25124  1.797  0.07237 . \nsurgeonGS         1.82111   6.17873  1.17355  1.552  0.12071   \nsurgeonKCCH       0.84534   2.32877  1.23979  0.682  0.49534   \nsurgeonLBC        1.33518   3.80069  1.08259  1.233  0.21746   \nsurgeonLGH        1.39732   4.04434  1.02052  1.369  0.17093   \nsurgeonLMC        0.96762   2.63166  1.06429  0.909  0.36326   \nsurgeonLYS        2.35394  10.52698  1.12773  2.087  0.03686 * \nsurgeonOKK        2.41672  11.20906  1.24459  1.942  0.05216 . \nsurgeonoutside    2.53862  12.66221  1.02984  2.465  0.01370 * \nsurgeonSYS        1.21122   3.35757  1.12605  1.076  0.28209   \nRiskIntermediate -1.10109   0.33251  0.48798 -2.256  0.02404 * \nRiskLow          -1.94527   0.14295  0.69673 -2.792  0.00524 **\npTT1b             0.27864   1.32134  0.39790  0.700  0.48375   \npTT2              0.93086   2.53669  0.41840  2.225  0.02610 * \npTT3a             1.33031   3.78220  0.56006  2.375  0.01753 * \npTT3b            -0.01178   0.98829  0.78975 -0.015  0.98810   \npTT4a             0.68142   1.97669  0.73389  0.929  0.35315   \npTT4b             2.56213  12.96338  1.41329  1.813  0.06985 . \ngross_ETEY       -0.02956   0.97087  0.70231 -0.042  0.96643   \npNN1a             0.68781   1.98935  0.38041  1.808  0.07059 . \npNN1b             0.87216   2.39207  0.41729  2.090  0.03661 * \npNNx             -0.27631   0.75858  0.63063 -0.438  0.66128   \nENEY             -0.53707   0.58446  0.46306 -1.160  0.24612   \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n                 exp(coef) exp(-coef) lower .95 upper .95\nsexM                1.5706    0.63672   0.95983    2.5699\nsurgeonGS           6.1787    0.16185   0.61940   61.6354\nsurgeonKCCH         2.3288    0.42941   0.20503   26.4507\nsurgeonLBC          3.8007    0.26311   0.45537   31.7224\nsurgeonLGH          4.0443    0.24726   0.54724   29.8895\nsurgeonLMC          2.6317    0.37999   0.32682   21.1911\nsurgeonLYS         10.5270    0.09499   1.15445   95.9916\nsurgeonOKK         11.2091    0.08921   0.97762  128.5198\nsurgeonoutside     12.6622    0.07898   1.68232   95.3038\nsurgeonSYS          3.3576    0.29783   0.36943   30.5153\nRiskIntermediate    0.3325    3.00745   0.12777    0.8653\nRiskLow             0.1429    6.99550   0.03649    0.5601\npTT1b               1.3213    0.75681   0.60578    2.8821\npTT2                2.5367    0.39422   1.11717    5.7599\npTT3a               3.7822    0.26440   1.26190   11.3361\npTT3b               0.9883    1.01185   0.21021    4.6465\npTT4a               1.9767    0.50590   0.46908    8.3297\npTT4b              12.9634    0.07714   0.81232  206.8754\ngross_ETEY          0.9709    1.03000   0.24511    3.8457\npNN1a               1.9894    0.50268   0.94386    4.1929\npNN1b               2.3921    0.41805   1.05579    5.4196\npNNx                0.7586    1.31826   0.22040    2.6109\nENEY                0.5845    1.71098   0.23583    1.4485\n\nConcordance= 0.792  (se = 0.024 )\nLikelihood ratio test= 112.5  on 23 df,   p=9e-14\nWald test            = 110.8  on 23 df,   p=2e-13\nScore (logrank) test = 176.7  on 23 df,   p=&lt;2e-16\n\n\n\n\nMultivariate - anova\n\nanova(cox_model1)는 Cox 회귀 모델에서 각 변수의 기여도를 평가하는 역할을 함.\n각 변수가 모델에 얼마나 중요한지 평가하고, p-value를 기반으로 불필요한 변수를 제거할 수 있음.\nDeviance 값이 크고 p-value가 낮은 변수는 중요한 변수이며, p-value가 높으면 제거를 고려할 수 있음.\n\n\nanova(cox_model1)\n\nAnalysis of Deviance Table\n Cox model: response is Surv(time, recur)\nTerms added sequentially (first to last)\n\n           loglik   Chisq Df Pr(&gt;|Chi|)    \nNULL      -567.06                          \nsex       -560.92 12.2949  1  0.0004542 ***\nsurgeon   -540.38 41.0665  9  4.864e-06 ***\nRisk      -521.33 38.1136  2  5.293e-09 ***\npT        -515.05 12.5592  6  0.0505954 .  \ngross_ETE -515.03  0.0306  1  0.8610979    \npN        -511.51  7.0409  3  0.0706054 .  \nENE       -510.84  1.3484  1  0.2455630    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\n\nCox 회귀 모델에서는 로그 우도를 최대화(즉, 덜 음수로 만듦) 하는 방향으로 최적화를 수행\n\nNULL 모델 (loglik = -567.06) → 변수가 없는 기본 모델\n모델이 점점 좋아질수록 loglik 값 증가\nsex 추가 후: loglik = -560.92 (증가)\nsurgeon 추가 후: loglik = -540.38 (더 증가)\nRisk 추가 후: loglik = -521.33 (더 증가)\n\n\n\n\nMultivariate - refit\n\ncox_model_refit &lt;- coxph(Surv(time, recur) ~ sex+surgeon+Risk, data = rai_recur)\nsummary(cox_model_refit)\n\nCall:\ncoxph(formula = Surv(time, recur) ~ sex + surgeon + Risk, data = rai_recur)\n\n  n= 1180, number of events= 83 \n\n                    coef exp(coef) se(coef)      z Pr(&gt;|z|)    \nsexM              0.4982    1.6457   0.2395  2.080 0.037565 *  \nsurgeonGS         2.1328    8.4382   1.1591  1.840 0.065765 .  \nsurgeonKCCH       1.0549    2.8717   1.2288  0.859 0.390615    \nsurgeonLBC        1.4876    4.4264   1.0806  1.377 0.168610    \nsurgeonLGH        1.4732    4.3630   1.0184  1.447 0.148017    \nsurgeonLMC        1.0942    2.9867   1.0618  1.030 0.302797    \nsurgeonLYS        2.4262   11.3163   1.0983  2.209 0.027169 *  \nsurgeonOKK        2.7836   16.1772   1.2349  2.254 0.024193 *  \nsurgeonoutside    2.7641   15.8650   1.0244  2.698 0.006967 ** \nsurgeonSYS        1.3356    3.8024   1.1204  1.192 0.233240    \nRiskIntermediate -0.9051    0.4045   0.2375 -3.811 0.000139 ***\nRiskLow          -2.2999    0.1003   0.4506 -5.105 3.31e-07 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n                 exp(coef) exp(-coef) lower .95 upper .95\nsexM                1.6457    0.60765   1.02906    2.6318\nsurgeonGS           8.4382    0.11851   0.87021   81.8234\nsurgeonKCCH         2.8717    0.34822   0.25835   31.9211\nsurgeonLBC          4.4264    0.22592   0.53245   36.7971\nsurgeonLGH          4.3630    0.22920   0.59284   32.1094\nsurgeonLMC          2.9867    0.33482   0.37270   23.9346\nsurgeonLYS         11.3163    0.08837   1.31470   97.4044\nsurgeonOKK         16.1772    0.06182   1.43790  182.0038\nsurgeonoutside     15.8650    0.06303   2.13064  118.1329\nsurgeonSYS          3.8024    0.26299   0.42299   34.1799\nRiskIntermediate    0.4045    2.47207   0.25397    0.6443\nRiskLow             0.1003    9.97356   0.04146    0.2425\n\nConcordance= 0.761  (se = 0.025 )\nLikelihood ratio test= 91.47  on 12 df,   p=3e-14\nWald test            = 86.44  on 12 df,   p=2e-13\nScore (logrank) test = 114.2  on 12 df,   p=&lt;2e-16\n\n\n\n\nsurvfit plot\n\nplot(survfit(cox_model1), ylim = c(0.6,1),xlab = \"months\",\nylab = \"Proportion not reached\")"
  }
]